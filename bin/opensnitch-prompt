#!/usr/bin/env python3
import sys
from PyQt5.QtGui import QColor
from PyQt5 import QtWidgets
from PyQt5 import QtCore
import argh

class MainWindow(QtWidgets.QMainWindow):
    def __init__(self, words):
        self.duration = 'once'
        self.scope = 'domain'
        self.action = 'allow'
        self.text = ' '.join(words)
        QtWidgets.QMainWindow.__init__(self)
        centralWidget = QtWidgets.QWidget(self)
        self.setCentralWidget(centralWidget)
        gridLayout = QtWidgets.QGridLayout(self)
        centralWidget.setLayout(gridLayout)
        palette = self.palette()
        palette.setColor(self.backgroundRole(), QColor(20, 20, 20))
        self.setPalette(palette)
        self.setStyleSheet("QLabel {font: 20pt Mono; color: rgb(200,200,200);}")
        self.title = QtWidgets.QLabel('', self)
        self.title.setAlignment(QtCore.Qt.AlignCenter)
        gridLayout.addWidget(self.title, 0, 0)
        self.update()

    def keyPressEvent(self, event, **kw):
        key = event.key()
        if key in [16777220, 16777216, 81]: # enter, esc, q
            sys.exit(0)
        elif key == 89: # y
            self.action = 'approve'
        elif key == 78: # n
            self.action = 'deny'
        elif key == 85: # u
            self.duration = 'until-quit'
        elif key == 72: # h
            self.scope = 'host'
        elif key == 67: # c
            pass
        else:
            print(key)
        self.update()

    def update(self):
        self.title.setText(f'{self.text}\n\n{self.duration} {self.scope} {self.action}')

@argh.dispatch_command
def main(*words):
    app = QtWidgets.QApplication(sys.argv)
    win = MainWindow(words)
    win.show()
    print(f'{win.duration} {win.scope} {win.action}')
    sys.exit(app.exec_())
